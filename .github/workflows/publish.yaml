on:
  push:
    branches: [main, master]
  pull_request:
    branches: [main, master]
  release:
    types: [published]
  workflow_dispatch:

name: Slides-Export

jobs:
  build:
    runs-on: ubuntu-latest
    name: Generate PDF  # Correction : déplacé ici
    steps:
      - uses: actions/checkout@v4

      - uses: quarto-dev/quarto-actions/setup@v2
        with:
          version: pre-release
          tinytex: false
      
      - name: Render Quarto Project
        shell: bash
        run: quarto render formation-R-perf-fonctions.qmd

      - name: List files after checkout
        run: |
          ls -al

      - name: Set up Node.js
        uses: actions/setup-node@v4

      - name: Convert Reveal.js to PDF
        shell: bash
        run: npx -y decktape reveal --chrome-arg=--no-sandbox --size "1920x1080" formation-R-perf-fonctions.html Diaporama_modules_fonctions.pdf

        
      - name: Clean up old deployment
        run: |
          git fetch origin
          git checkout gh-pages
          git rm -rf .  # Supprime les anciens fichiers sur la branche gh-pages
          
      - name: Rename HTML file to index.html
        run: |
          ls -al  # Ajouter un autre listing juste avant la commande mv pour voir si le fichier est bien là
          mv ./formation-R-perf-fonctions.html ./index.html || echo "File not found, skipping rename"

      - name: Build and Deploy
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages  # Branche de destination
          folder: ./        # Dossier à publier, ici la racine
          target-folder: ./  # Dossier cible sur GitHub Pages
          commit-message: "Deploy HTML file"
          clean: true        # Pour nettoyer le répertoire de déploiement à chaque fois
          dry-run: false     # Désactiver le mode dry-run pour tester un déploiement réel

